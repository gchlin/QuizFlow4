<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QuizFlow 3.2 - å­¸ç¿’éŠæˆ²å¹³å°</title>
    <link rel="stylesheet" href="css/menu.css">
</head>
<body>
    <div class="menu-container">
        <h1>ğŸ® QuizFlow å­¸ç¿’éŠæˆ²</h1>
        <p class="page-subtitle">é¸æ“‡ä¸€å€‹ä¸»é¡Œé–‹å§‹æŒ‘æˆ°ï¼</p>
        
        <div id="themeGrid" class="theme-grid">
            <!-- JavaScript æœƒå‹•æ…‹ç”¢ç”Ÿä¸»é¡Œå¡ç‰‡ -->
            <div class="loading">è¼‰å…¥ä¸»é¡Œä¸­</div>
        </div>

        <div class="footer">
            <p>QuizFlow 3.2 - é€šç”¨å­¸ç¿’éŠæˆ²å¹³å°</p>
            <p>Design: <a href="mailto:chaher@dysh.tyc.edu.tw">chaher@dysh.tyc.edu.tw</a> | AI Coding</p>
        </div>
    </div>

    <script src="core/theme-loader.js"></script>
    <script>
        // å¯ç”¨çš„ä¸»é¡Œåˆ—è¡¨
        const availableThemes = [
            'wave-harmonics',
            // 'multiplication',
            // 'trigonometry'
            // æœªä¾†æ–°å¢ä¸»é¡Œæ™‚ï¼Œåœ¨é€™è£¡åŠ ä¸Šä¸»é¡Œ ID
        ];

        /**
         * è¼‰å…¥æ‰€æœ‰ä¸»é¡Œ
         */
        async function loadThemes() {
            const loader = new ThemeLoader();
            const grid = document.getElementById('themeGrid');
            grid.innerHTML = ''; // æ¸…ç©ºè¼‰å…¥è¨Šæ¯

            for (const themeId of availableThemes) {
                try {
                    console.log(`ğŸ“¥ è¼‰å…¥ä¸»é¡Œ: ${themeId}`);
                    const themeData = await loader.loadTheme(themeId);
                    
                    // æª¢æŸ¥æ˜¯å¦æœ‰ menuDisplay è³‡æ–™
                    if (!themeData.theme.menuDisplay) {
                        console.warn(`âš ï¸ ä¸»é¡Œ ${themeId} ç¼ºå°‘ menuDisplay è³‡æ–™ï¼Œä½¿ç”¨é è¨­å€¼`);
                        themeData.theme.menuDisplay = createDefaultMenuDisplay(themeId);
                    }

                    const card = createThemeCard(themeId, themeData.theme);
                    grid.appendChild(card);
                    
                    console.log(`âœ… ä¸»é¡Œ ${themeId} è¼‰å…¥æˆåŠŸ`);
                } catch (error) {
                    console.error(`âŒ è¼‰å…¥ä¸»é¡Œ ${themeId} å¤±æ•—:`, error);
                    
                    // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                    const errorCard = document.createElement('div');
                    errorCard.className = 'error-message';
                    errorCard.innerHTML = `
                        <h3>âŒ è¼‰å…¥å¤±æ•—</h3>
                        <p>ä¸»é¡Œï¼š${themeId}</p>
                        <p>éŒ¯èª¤ï¼š${error.message}</p>
                    `;
                    grid.appendChild(errorCard);
                }
            }

            // å¦‚æœæ²’æœ‰ä»»ä½•ä¸»é¡Œè¼‰å…¥æˆåŠŸ
            if (grid.children.length === 0) {
                grid.innerHTML = `
                    <div class="error-message">
                        <h3>âŒ æ‰¾ä¸åˆ°å¯ç”¨çš„ä¸»é¡Œ</h3>
                        <p>è«‹ç¢ºèª themes è³‡æ–™å¤¾ä¸­æ˜¯å¦æœ‰ä¸»é¡Œæª”æ¡ˆ</p>
                    </div>
                `;
            }
        }

        /**
         * å‰µå»ºé è¨­çš„ menuDisplayï¼ˆå¦‚æœä¸»é¡Œæ²’æœ‰å®šç¾©ï¼‰
         */
        function createDefaultMenuDisplay(themeId) {
            return {
                icon: 'ğŸ®',
                title: themeId,
                subtitle: '',
                description: 'é€™å€‹ä¸»é¡Œå°šæœªè¨­å®šæè¿°',
                category: 'æœªåˆ†é¡',
                difficulty: 'æœªçŸ¥',
                primaryColor: '#4A90E2',
                accentColor: '#7B68EE'
            };
        }

        /**
         * å‹•æ…‹ç”¢ç”Ÿä¸»é¡Œå¡ç‰‡
         */
        function createThemeCard(themeId, theme) {
            const menu = theme.menuDisplay;
            
            const card = document.createElement('div');
            card.className = 'theme-card';
            
            // ğŸ¨ å‹•æ…‹å¥—ç”¨ä¸»é¡Œè‰²
            card.style.setProperty('--theme-primary', menu.primaryColor);
            card.style.setProperty('--theme-accent', menu.accentColor);
            
            // å¦‚æœæœ‰æ¼¸å±¤èƒŒæ™¯ï¼Œå¥—ç”¨
            if (menu.gradient) {
                card.style.background = menu.gradient;
            }
            
            // æ ¹æ“šé›£åº¦è¨­å®šä¸åŒçš„æ¨£å¼
            let difficultyClass = 'medium';
            if (menu.difficulty) {
                const diff = menu.difficulty.toLowerCase();
                if (diff.includes('ç°¡å–®') || diff.includes('easy')) {
                    difficultyClass = 'easy';
                } else if (diff.includes('å›°é›£') || diff.includes('hard') || diff.includes('é€²éš')) {
                    difficultyClass = 'hard';
                }
            }
            
            card.innerHTML = `
                <div class="theme-icon">${menu.icon || menu.emoji || 'ğŸ®'}</div>
                <h2>${menu.title || themeId}</h2>
                ${menu.subtitle ? `<p class="card-subtitle">${menu.subtitle}</p>` : ''}
                <p class="description">${menu.description || 'å°šæœªè¨­å®šæè¿°'}</p>
                <div class="theme-meta">
                    <span class="badge category">${menu.category || 'æœªåˆ†é¡'}</span>
                    <span class="badge difficulty ${difficultyClass}">${menu.difficulty || 'æœªçŸ¥'}</span>
                </div>
                <button class="play-btn" onclick="startGame('${themeId}')">
                    é–‹å§‹éŠæˆ² â†’
                </button>
            `;
            
            return card;
        }

        /**
         * é–‹å§‹éŠæˆ²
         */
        function startGame(themeId) {
            console.log(`ğŸ® å•Ÿå‹•éŠæˆ²: ${themeId}`);
            window.location.href = `game.html?theme=${themeId}`;
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ QuizFlow 3.2 ä¸»é¸å–®è¼‰å…¥ä¸­...');
            loadThemes();
        });

        // éŒ¯èª¤è™•ç†
        window.addEventListener('error', (event) => {
            console.error('ğŸ’¥ é é¢éŒ¯èª¤:', event.error);
        });
    </script>
</body>
</html>

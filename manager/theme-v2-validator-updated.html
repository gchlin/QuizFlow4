<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme V2 é©—è­‰å·¥å…·ï¼ˆå« Metadata æª¢æŸ¥ï¼‰</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: "Microsoft JhengHei", "Segoe UI", Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        h1 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        h2 {
            color: #764ba2;
            margin-top: 25px;
        }
        .section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .upload-area {
            border: 3px dashed #667eea;
            padding: 40px;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        .upload-area:hover {
            background: #f0f4ff;
            border-color: #764ba2;
            transform: translateY(-2px);
        }
        .upload-area.dragover {
            background: #e8edff;
            border-color: #764ba2;
            transform: scale(1.02);
        }
        input[type="file"] {
            display: none;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }
        .btn-warning {
            background: linear-gradient(135deg, #ffd93d 0%, #f9ca24 100%);
            color: #333;
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .result.success {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
        }
        .result.warning {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            color: #856404;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        .info-item {
            padding: 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }
        .info-label {
            font-weight: bold;
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .info-value {
            color: #333;
            font-size: 16px;
        }
        .check-item {
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .check-item.pass {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        .check-item.fail {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .check-item.warn {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        .icon {
            font-size: 24px;
            flex-shrink: 0;
        }
        .fix-section {
            background: #fff3cd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 2px solid #ffc107;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
        }
        .code-block pre {
            margin: 0;
        }
        .metadata-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #ddd;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }
        .highlight {
            background: #fffacd;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
        .tab-container {
            margin-top: 20px;
        }
        .tab-buttons {
            display: flex;
            gap: 5px;
            border-bottom: 2px solid #ddd;
            margin-bottom: 15px;
        }
        .tab-btn {
            padding: 10px 20px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 6px 6px 0 0;
            font-weight: bold;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: #667eea;
            color: white;
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ Theme V2 é©—è­‰å·¥å…·ï¼ˆå« Metadata æª¢æŸ¥ï¼‰</h1>
        
        <div class="section">
            <h2>ğŸ“‚ ä¸Šå‚³ Theme JSON æª”æ¡ˆ</h2>
            <div class="upload-area" id="uploadArea">
                <p style="font-size: 48px; margin: 0;">ğŸ“„</p>
                <p style="font-size: 18px; margin: 10px 0;">æ‹–æ›³æª”æ¡ˆåˆ°é€™è£¡</p>
                <p style="color: #666;">æˆ–é»æ“Šé¸æ“‡æª”æ¡ˆ</p>
                <p style="font-size: 14px; color: #999;">æ”¯æ´ theme-v2.json</p>
            </div>
            <input type="file" id="fileInput" accept=".json">
        </div>

        <div id="resultArea"></div>
    </div>

    <script>
        let currentData = null;
        let currentFileName = '';

        // ä¸Šå‚³å€åŸŸè™•ç†
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const resultArea = document.getElementById('resultArea');

        uploadArea.addEventListener('click', () => fileInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) handleFile(file);
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleFile(file);
        });

        // è™•ç†æª”æ¡ˆ
        function handleFile(file) {
            currentFileName = file.name;
            const reader = new FileReader();
            
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    currentData = data;
                    validateTheme(data);
                } catch (error) {
                    showError('JSON æ ¼å¼éŒ¯èª¤ï¼š' + error.message);
                }
            };
            
            reader.readAsText(file);
        }

        // é©—è­‰ä¸»é¡Œ
        function validateTheme(data) {
            const results = {
                passed: [],
                failed: [],
                warnings: []
            };

            // æª¢æŸ¥ metadata
            checkMetadata(data, results);

            // æª¢æŸ¥å¿…è¦æ¬„ä½
            checkRequired(data, results);

            // æª¢æŸ¥ colors
            if (data.colors) {
                checkColors(data.colors, results);
            }

            // æª¢æŸ¥ layout
            if (data.layout) {
                checkLayout(data.layout, results);
            }

            // æª¢æŸ¥ messages
            if (data.messages) {
                checkMessages(data.messages, results);
            }

            // é¡¯ç¤ºçµæœ
            displayResults(results, data);
        }

        // æª¢æŸ¥ metadataï¼ˆé‡é»ï¼ï¼‰
        function checkMetadata(data, results) {
            if (!data.metadata) {
                results.warnings.push({
                    field: 'metadata',
                    message: 'ç¼ºå°‘ metadata æ¬„ä½',
                    fix: 'canAutoFix',
                    severity: 'warning'
                });
                return;
            }

            const meta = data.metadata;

            // æª¢æŸ¥å¿…è¦å­æ¬„ä½
            if (!meta.name) {
                results.warnings.push({
                    field: 'metadata.name',
                    message: 'å»ºè­°åŠ ä¸Šä¸»é¡Œåç¨±',
                    fix: 'canAutoFix'
                });
            } else {
                results.passed.push({
                    field: 'metadata.name',
                    message: `ä¸»é¡Œåç¨±ï¼š${meta.name}`
                });
            }

            if (!meta.version) {
                results.warnings.push({
                    field: 'metadata.version',
                    message: 'å»ºè­°åŠ ä¸Šç‰ˆæœ¬è™Ÿ',
                    fix: 'canAutoFix'
                });
            } else {
                results.passed.push({
                    field: 'metadata.version',
                    message: `ç‰ˆæœ¬ï¼š${meta.version}`
                });
            }

            if (!meta.author) {
                results.warnings.push({
                    field: 'metadata.author',
                    message: 'å»ºè­°åŠ ä¸Šä½œè€…è³‡è¨Š',
                    fix: 'canAutoFix'
                });
            } else {
                results.passed.push({
                    field: 'metadata.author',
                    message: `ä½œè€…ï¼š${meta.author}`
                });
            }

            if (!meta.description) {
                results.warnings.push({
                    field: 'metadata.description',
                    message: 'å»ºè­°åŠ ä¸Šä¸»é¡Œæè¿°',
                    fix: 'canAutoFix'
                });
            } else {
                results.passed.push({
                    field: 'metadata.description',
                    message: `æè¿°ï¼š${meta.description}`
                });
            }
        }

        // æª¢æŸ¥å¿…è¦æ¬„ä½
        function checkRequired(data, results) {
            const required = ['colors', 'layout', 'messages'];
            
            required.forEach(field => {
                if (!data[field]) {
                    results.failed.push({
                        field: field,
                        message: `ç¼ºå°‘å¿…è¦æ¬„ä½ï¼š${field}`,
                        severity: 'error'
                    });
                } else {
                    results.passed.push({
                        field: field,
                        message: `${field} æ¬„ä½å­˜åœ¨`
                    });
                }
            });
        }

        // æª¢æŸ¥ colors
        function checkColors(colors, results) {
            const requiredColors = ['player1', 'player2', 'background'];
            
            requiredColors.forEach(color => {
                if (!colors[color]) {
                    results.failed.push({
                        field: `colors.${color}`,
                        message: `ç¼ºå°‘é¡è‰²è¨­å®šï¼š${color}`
                    });
                } else {
                    results.passed.push({
                        field: `colors.${color}`,
                        message: `${color}: ${colors[color]}`
                    });
                }
            });
        }

        // æª¢æŸ¥ layout
        function checkLayout(layout, results) {
            if (layout.optionGrid) {
                results.passed.push({
                    field: 'layout.optionGrid',
                    message: 'æ’ç‰ˆè¨­å®šå­˜åœ¨'
                });
            } else {
                results.warnings.push({
                    field: 'layout.optionGrid',
                    message: 'å»ºè­°åŠ ä¸Šæ’ç‰ˆè¨­å®š'
                });
            }
        }

        // æª¢æŸ¥ messages
        function checkMessages(messages, results) {
            const requiredMsg = ['win', 'lose'];
            
            requiredMsg.forEach(msg => {
                if (!messages[msg]) {
                    results.warnings.push({
                        field: `messages.${msg}`,
                        message: `å»ºè­°åŠ ä¸Š ${msg} è¨Šæ¯`
                    });
                } else {
                    results.passed.push({
                        field: `messages.${msg}`,
                        message: `${msg} è¨Šæ¯å·²è¨­å®š`
                    });
                }
            });
        }

        // é¡¯ç¤ºçµæœ
        function displayResults(results, data) {
            const hasMetadataIssue = results.warnings.some(w => w.field === 'metadata');
            const hasErrors = results.failed.length > 0;
            const hasWarnings = results.warnings.length > 0;

            let html = '';

            // ç¸½çµ
            if (hasErrors) {
                html += `<div class="result error" style="display:block;">
                    <h2>âŒ é©—è­‰å¤±æ•—</h2>
                    <p>ç™¼ç¾ ${results.failed.length} å€‹éŒ¯èª¤ï¼Œ${results.warnings.length} å€‹è­¦å‘Š</p>
                </div>`;
            } else if (hasWarnings) {
                html += `<div class="result warning" style="display:block;">
                    <h2>âš ï¸ é©—è­‰é€šéï¼ˆæœ‰è­¦å‘Šï¼‰</h2>
                    <p>ç™¼ç¾ ${results.warnings.length} å€‹è­¦å‘Š</p>
                </div>`;
            } else {
                html += `<div class="result success" style="display:block;">
                    <h2>âœ… é©—è­‰å®Œå…¨é€šé</h2>
                    <p>æ‰€æœ‰æª¢æŸ¥é …ç›®éƒ½é€šéäº†ï¼</p>
                </div>`;
            }

            // Tab åˆ‡æ›
            html += `
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="switchTab('summary')">ğŸ“Š æ‘˜è¦</button>
                        <button class="tab-btn" onclick="switchTab('details')">ğŸ“‹ è©³ç´°</button>
                        ${hasMetadataIssue ? '<button class="tab-btn" onclick="switchTab(\'fix\')">ğŸ”§ ä¿®å¾© Metadata</button>' : ''}
                    </div>

                    <div id="tab-summary" class="tab-content active">
                        ${generateSummary(results, data)}
                    </div>

                    <div id="tab-details" class="tab-content">
                        ${generateDetails(results)}
                    </div>

                    ${hasMetadataIssue ? `
                    <div id="tab-fix" class="tab-content">
                        ${generateFixSection(data)}
                    </div>
                    ` : ''}
                </div>
            `;

            resultArea.innerHTML = html;
        }

        // ç”Ÿæˆæ‘˜è¦
        function generateSummary(results, data) {
            let html = '<div class="section">';
            
            html += '<h2>ğŸ“Š é©—è­‰æ‘˜è¦</h2>';
            html += `<div class="info-grid">
                <div class="info-item">
                    <div class="info-label">æª”æ¡ˆåç¨±</div>
                    <div class="info-value">${currentFileName}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">æª”æ¡ˆå¤§å°</div>
                    <div class="info-value">${(JSON.stringify(data).length / 1024).toFixed(2)} KB</div>
                </div>
                <div class="info-item">
                    <div class="info-label">é€šéé …ç›®</div>
                    <div class="info-value" style="color: #28a745;">${results.passed.length}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">è­¦å‘Šé …ç›®</div>
                    <div class="info-value" style="color: #ffc107;">${results.warnings.length}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">éŒ¯èª¤é …ç›®</div>
                    <div class="info-value" style="color: #dc3545;">${results.failed.length}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Metadata</div>
                    <div class="info-value">${data.metadata ? 'âœ… æœ‰' : 'âš ï¸ ç¼ºå°‘'}</div>
                </div>
            </div>`;

            html += '</div>';
            return html;
        }

        // ç”Ÿæˆè©³ç´°è³‡è¨Š
        function generateDetails(results) {
            let html = '<div class="section">';

            // éŒ¯èª¤
            if (results.failed.length > 0) {
                html += '<h2 style="color: #dc3545;">âŒ éŒ¯èª¤</h2>';
                results.failed.forEach(item => {
                    html += `<div class="check-item fail">
                        <span class="icon">âŒ</span>
                        <div>
                            <strong>${item.field}</strong><br>
                            ${item.message}
                        </div>
                    </div>`;
                });
            }

            // è­¦å‘Š
            if (results.warnings.length > 0) {
                html += '<h2 style="color: #ffc107;">âš ï¸ è­¦å‘Š</h2>';
                results.warnings.forEach(item => {
                    html += `<div class="check-item warn">
                        <span class="icon">âš ï¸</span>
                        <div>
                            <strong>${item.field}</strong><br>
                            ${item.message}
                        </div>
                    </div>`;
                });
            }

            // é€šé
            if (results.passed.length > 0) {
                html += '<h2 style="color: #28a745;">âœ… é€šé</h2>';
                results.passed.forEach(item => {
                    html += `<div class="check-item pass">
                        <span class="icon">âœ…</span>
                        <div>
                            <strong>${item.field}</strong><br>
                            ${item.message}
                        </div>
                    </div>`;
                });
            }

            html += '</div>';
            return html;
        }

        // ç”Ÿæˆä¿®å¾©å€åŸŸ
        function generateFixSection(data) {
            const hasMetadata = data.metadata;
            
            let html = `
                <div class="fix-section">
                    <h2>ğŸ”§ è‡ªå‹•ä¿®å¾© Metadata</h2>
                    <p>å¡«å¯«ä¸‹æ–¹è³‡è¨Šï¼Œç³»çµ±æœƒè‡ªå‹•ç”¢ç”Ÿå®Œæ•´çš„ JSON æª”æ¡ˆ</p>

                    <div class="metadata-form">
                        <div class="form-group">
                            <label>ä¸»é¡Œåç¨± <span style="color: red;">*</span></label>
                            <input type="text" id="metaName" placeholder="ä¾‹å¦‚ï¼šStanding Wave Harmonics" 
                                value="${hasMetadata && data.metadata.name ? data.metadata.name : ''}">
                        </div>

                        <div class="form-group">
                            <label>ç‰ˆæœ¬è™Ÿ <span style="color: red;">*</span></label>
                            <input type="text" id="metaVersion" placeholder="ä¾‹å¦‚ï¼š2.0" 
                                value="${hasMetadata && data.metadata.version ? data.metadata.version : '2.0'}">
                        </div>

                        <div class="form-group">
                            <label>ä½œè€…</label>
                            <input type="text" id="metaAuthor" placeholder="ä¾‹å¦‚ï¼šchaher@dysh.tyc.edu.tw" 
                                value="${hasMetadata && data.metadata.author ? data.metadata.author : ''}">
                        </div>

                        <div class="form-group">
                            <label>æè¿°</label>
                            <textarea id="metaDescription" placeholder="ä¾‹å¦‚ï¼šé§æ³¢æ³›éŸ³ç‰©ç†æ•™å­¸éŠæˆ²ä¸»é¡Œ">${hasMetadata && data.metadata.description ? data.metadata.description : ''}</textarea>
                        </div>

                        <button class="btn btn-success" onclick="generateFixedJSON()">
                            âœ¨ ç”¢ç”Ÿå®Œæ•´ JSON
                        </button>
                        <button class="btn btn-warning" onclick="copyMetadataCode()">
                            ğŸ“‹ åªè¤‡è£½ metadata ä»£ç¢¼
                        </button>
                    </div>

                    <div id="fixedResult"></div>
                </div>

                <div class="section">
                    <h2>ğŸ“š æ‰‹å‹•ä¿®å¾©æ•™å­¸</h2>
                    <p><strong>æ­¥é©Ÿ 1ï¼š</strong>æ‰“é–‹ä½ çš„ <span class="highlight">theme-v2.json</span></p>
                    <p><strong>æ­¥é©Ÿ 2ï¼š</strong>åœ¨æª”æ¡ˆæœ€ä¸Šé¢ï¼ˆç¬¬ä¸€å€‹ <code>{</code> å¾Œé¢ï¼‰åŠ å…¥ï¼š</p>
                    
                    <div class="code-block"><pre>"metadata": {
  "name": "ä½ çš„ä¸»é¡Œåç¨±",
  "version": "2.0",
  "author": "ä½ çš„åå­—",
  "description": "ä¸»é¡Œæè¿°"
},</pre></div>

                    <p><strong>æ­¥é©Ÿ 3ï¼š</strong>è¨˜å¾—å¾Œé¢è¦æœ‰é€—è™Ÿ <code>,</code></p>
                    <p><strong>æ­¥é©Ÿ 4ï¼š</strong>å„²å­˜å¾Œé‡æ–°é©—è­‰</p>
                </div>
            `;

            return html;
        }

        // ç”¢ç”Ÿä¿®å¾©å¾Œçš„ JSON
        function generateFixedJSON() {
            const name = document.getElementById('metaName').value.trim();
            const version = document.getElementById('metaVersion').value.trim();
            const author = document.getElementById('metaAuthor').value.trim();
            const description = document.getElementById('metaDescription').value.trim();

            if (!name || !version) {
                alert('è«‹å¡«å¯«ä¸»é¡Œåç¨±å’Œç‰ˆæœ¬è™Ÿï¼');
                return;
            }

            // å»ºç«‹æ–°çš„ metadata
            const metadata = {
                name: name,
                version: version
            };

            if (author) metadata.author = author;
            if (description) metadata.description = description;

            // å»ºç«‹å®Œæ•´çš„ JSON
            const fixedData = {
                metadata: metadata,
                ...currentData
            };

            // å¦‚æœåŸæœ¬å°±æœ‰ metadataï¼Œè¦ç§»é™¤èˆŠçš„
            if (currentData.metadata) {
                delete fixedData.metadata;
                fixedData.metadata = metadata;
            }

            const jsonString = JSON.stringify(fixedData, null, 2);

            const resultHTML = `
                <div style="margin-top: 20px;">
                    <h3>âœ… å®Œæ•´çš„ JSONï¼ˆå·²ä¿®å¾©ï¼‰</h3>
                    <div class="code-block"><pre>${escapeHtml(jsonString)}</pre></div>
                    <button class="btn btn-success" onclick="downloadJSON()">
                        ğŸ’¾ ä¸‹è¼‰ JSON æª”æ¡ˆ
                    </button>
                    <button class="btn" onclick="copyToClipboard('${escapeHtml(jsonString).replace(/'/g, "\\'")}')">
                        ğŸ“‹ è¤‡è£½åˆ°å‰ªè²¼ç°¿
                    </button>
                </div>
            `;

            document.getElementById('fixedResult').innerHTML = resultHTML;

            // å„²å­˜ä¿®å¾©å¾Œçš„è³‡æ–™
            window.fixedData = fixedData;
        }

        // åªè¤‡è£½ metadata ä»£ç¢¼
        function copyMetadataCode() {
            const name = document.getElementById('metaName').value.trim();
            const version = document.getElementById('metaVersion').value.trim();
            const author = document.getElementById('metaAuthor').value.trim();
            const description = document.getElementById('metaDescription').value.trim();

            if (!name || !version) {
                alert('è«‹å¡«å¯«ä¸»é¡Œåç¨±å’Œç‰ˆæœ¬è™Ÿï¼');
                return;
            }

            let code = '"metadata": {\n';
            code += `  "name": "${name}",\n`;
            code += `  "version": "${version}"`;
            
            if (author) code += `,\n  "author": "${author}"`;
            if (description) code += `,\n  "description": "${description}"`;
            
            code += '\n},';

            copyToClipboard(code);
            alert('âœ… Metadata ä»£ç¢¼å·²è¤‡è£½ï¼\n\nè«‹è²¼åˆ° theme-v2.json çš„æœ€ä¸Šé¢');
        }

        // ä¸‹è¼‰ JSON
        function downloadJSON() {
            if (!window.fixedData) return;

            const blob = new Blob([JSON.stringify(window.fixedData, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = currentFileName.replace('.json', '-fixed.json');
            a.click();
            URL.revokeObjectURL(url);

            alert('âœ… å·²ä¸‹è¼‰ä¿®å¾©å¾Œçš„æª”æ¡ˆï¼');
        }

        // è¤‡è£½åˆ°å‰ªè²¼ç°¿
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }

        // HTML è½‰ç¾©
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Tab åˆ‡æ›
        function switchTab(tabName) {
            // éš±è—æ‰€æœ‰ tab
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // é¡¯ç¤ºé¸ä¸­çš„ tab
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // éŒ¯èª¤é¡¯ç¤º
        function showError(message) {
            resultArea.innerHTML = `
                <div class="result error" style="display:block;">
                    <h2>âŒ éŒ¯èª¤</h2>
                    <p>${message}</p>
                </div>
            `;
        }
    </script>
</body>
</html>

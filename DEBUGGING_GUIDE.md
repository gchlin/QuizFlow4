# 🔧 軟體除錯完整指南
## 從錯誤訊息到問題解決：實戰經驗總結

---

## 📋 目錄

1. [除錯的黃金法則](#除錯的黃金法則)
2. [這次除錯的完整過程](#這次除錯的完整過程)
3. [可重複使用的除錯策略](#可重複使用的除錯策略)
4. [與工程師溝通的技巧](#與工程師溝通的技巧)
5. [實用工具清單](#實用工具清單)
6. [常見錯誤類型與解決方案](#常見錯誤類型與解決方案)

---

## 🎯 除錯的黃金法則

### 1. 不要猜測，要驗證
❌ 「我覺得可能是這個問題」
✅ 「讓我們測試看看是不是這個問題」

### 2. 縮小範圍
從大範圍逐步縮小到具體問題：
```
整個系統有問題
  → 是前端還是後端？
    → 是哪個模組？
      → 是哪個文件？
        → 是哪一行代碼？
```

### 3. 建立可重現的測試
如果能重現錯誤，就能修復它。

### 4. 保留證據
截圖、錯誤訊息、Console 輸出都是寶貴的線索。

### 5. 逐步驗證假設
每次只改一件事，看結果如何。

---

## 🔍 這次除錯的完整過程

### 階段 1：發現問題（第一個錯誤報告）

**問題描述：**
```
遊戲載入失敗，請重新整理頁面。
錯誤：無法載入主題「wave-harmonics」：Failed to fetch
```

**初步診斷策略：**

1️⃣ **識別錯誤類型**
   - `Failed to fetch` = 文件載入問題
   - 可能原因：文件不存在、路徑錯誤、權限問題

2️⃣ **檢查文件結構**
   - 要求用戶提供文件夾截圖或 `dir` 命令輸出
   - 驗證：文件是否存在？路徑是否正確？

3️⃣ **識別環境問題**
   - 詢問：如何開啟文件？（雙擊 vs 本地伺服器）
   - 解釋：瀏覽器的 CORS 限制

**解決方案：**
- 使用本地伺服器（`python -m http.server 8000`）
- 解釋為什麼需要伺服器（CORS 政策）

**關鍵學習：**
- Web 應用需要伺服器環境
- 直接開啟 HTML 文件會有安全限制

---

### 階段 2：第二個錯誤（GameEngine 未定義）

**問題描述：**
```
初始化失敗: ReferenceError: GameEngine is not defined
```

**診斷策略：**

1️⃣ **確認文件確實存在**
   ```cmd
   dir core\game-engine.js
   ```
   結果：文件存在，37KB

2️⃣ **檢查瀏覽器 Network 標籤**
   - 要求截圖
   - 查看：文件是否成功載入？HTTP 狀態碼？

3️⃣ **檢查 Console 錯誤**
   - 要求完整的 Console 輸出
   - 分析：theme-loader 載入成功，但 game-engine 失敗

4️⃣ **懷疑文件內容問題**
   - 文件大小正確，但可能不完整
   - 要求檢查 index.html 結尾

**發現問題：**
- index.html 不完整（被截斷）
- 缺少 error 處理和閉合標籤

**解決方案：**
- 創建完整的 index-fixed.html
- 加入詳細的錯誤處理和檢查

**關鍵學習：**
- 文件可能在複製時損壞
- 需要驗證文件的完整性

---

### 階段 3：語法錯誤（Unexpected token）

**問題描述：**
```
Uncaught SyntaxError: Unexpected token '{'
```

**診斷策略：**

1️⃣ **創建測試工具**
   - 建立 `test-js-loading.html`
   - 逐項檢查：ThemeLoader、GameEngine、文件路徑

2️⃣ **測試結果分析**
   ```
   ✅ ThemeLoader 存在
   ❌ GameEngine 不存在
   ✅ game-engine.js 文件可訪問
   ✅ 找到導出語句
   ```

3️⃣ **矛盾分析**
   - 文件存在 ✅
   - 導出語句存在 ✅
   - 但 GameEngine 未定義 ❌
   - → 結論：文件有語法錯誤，無法執行

4️⃣ **使用語法檢查工具**
   ```bash
   node -c core/game-engine.js
   ```
   
   發現：第 573 行有語法錯誤

5️⃣ **定位具體問題**
   - 查看第 573 行附近的代碼
   - 發現：class 提前結束，後面的方法在 class 外面

**根本原因：**
```javascript
// 第 560 行：某個方法結束
}

// 第 562 行：註釋「待續...」
// 第 563 行：class 錯誤地結束了！❌
}

// 第 565-568 行：提前導出
if (typeof window !== 'undefined') {
    window.GameEngine = GameEngine;
}

// 第 570 行開始：更多方法（但在 class 外！）❌
handleAnswer(player, answerId, btnElement, event) {
```

**解決方案：**
- 移除錯誤的 class 結束
- 移除中間的導出語句
- 確保所有方法在 class 內部

**關鍵學習：**
- 語法錯誤會阻止整個文件執行
- 使用工具（node -c）可以快速定位錯誤
- 文件結構很重要

---

## 🛠️ 可重複使用的除錯策略

### 策略 1：分層診斷法

```
第 1 層：環境檢查
├─ 文件是否存在？
├─ 路徑是否正確？
├─ 伺服器是否運行？
└─ 瀏覽器是否支援？

第 2 層：載入檢查
├─ 文件是否成功載入？（Network 標籤）
├─ HTTP 狀態碼是什麼？
├─ 文件大小是否正確？
└─ 是否有 CORS 錯誤？

第 3 層：執行檢查
├─ 是否有語法錯誤？
├─ 變數是否正確定義？
├─ 依賴關係是否正確？
└─ 初始化是否成功？

第 4 層：邏輯檢查
├─ 函數是否正確執行？
├─ 數據是否正確傳遞？
├─ 狀態管理是否正確？
└─ 業務邏輯是否正確？
```

---

### 策略 2：錯誤訊息解讀表

| 錯誤訊息 | 可能原因 | 檢查方法 | 解決方案 |
|---------|---------|---------|---------|
| `Failed to fetch` | 文件不存在<br>路徑錯誤<br>CORS 限制 | 1. 檢查文件是否存在<br>2. 檢查路徑拼寫<br>3. 使用本地伺服器 | 修正路徑<br>啟動伺服器 |
| `X is not defined` | 文件未載入<br>載入順序錯誤<br>語法錯誤 | 1. Network 標籤<br>2. 檢查 script 順序<br>3. 語法檢查 | 調整載入順序<br>修復語法 |
| `SyntaxError` | 語法錯誤<br>文件損壞<br>編碼問題 | 1. 語法檢查工具<br>2. 查看錯誤行號<br>3. 檢查編碼 | 修復語法<br>重新下載文件 |
| `TypeError: Cannot read property` | 物件未初始化<br>null/undefined | 1. Console 輸出物件<br>2. 檢查初始化順序 | 加入檢查<br>調整順序 |
| `404 Not Found` | 文件路徑錯誤<br>文件不存在 | 1. 檢查 Network 標籤<br>2. 驗證路徑 | 修正路徑<br>添加文件 |

---

### 策略 3：建立測試工具

**為什麼需要測試工具？**
- 快速驗證假設
- 隔離問題
- 可重複測試

**這次創建的測試工具：**

1. **test-js-loading.html** - 驗證 JS 文件載入
2. **theme-v2-validator.html** - 驗證 JSON 格式
3. **index-fixed.html** - 加強錯誤處理的版本

**測試工具設計原則：**
```javascript
✅ 逐項測試（不要一次測太多）
✅ 清楚的成功/失敗標記（✅/❌）
✅ 詳細的錯誤訊息
✅ 獨立運行（不依賴其他文件）
✅ 提供下一步建議
```

---

### 策略 4：增量修復法

**原則：每次只改一件事**

```
步驟 1：確認問題
  ↓
步驟 2：提出假設
  ↓
步驟 3：設計測試
  ↓
步驟 4：執行修改（只改一處）
  ↓
步驟 5：驗證結果
  ├─ 成功 → 繼續下一個問題
  └─ 失敗 → 回到步驟 2
```

**這次的應用：**
1. 先解決環境問題（本地伺服器）
2. 再解決文件完整性（index.html）
3. 最後解決語法錯誤（game-engine.js）

**避免的錯誤：**
❌ 同時修改多個文件
❌ 不驗證就繼續改
❌ 修改後不記錄改了什麼

---

### 策略 5：資訊收集清單

**當遇到錯誤時，收集以下資訊：**

#### A. 環境資訊
```
□ 作業系統（Windows/Mac/Linux）
□ 瀏覽器（Chrome/Firefox/Safari）
□ 瀏覽器版本
□ 如何開啟應用（雙擊/本地伺服器/線上）
□ 文件夾路徑
```

#### B. 錯誤資訊
```
□ 完整的錯誤訊息（文字）
□ Console 截圖（F12 → Console）
□ Network 截圖（F12 → Network）
□ 錯誤發生的步驟
□ 能否重現？
```

#### C. 文件資訊
```
□ 文件結構截圖或 dir 輸出
□ 相關文件的大小
□ 文件的最後修改時間
□ 文件是否完整？
```

#### D. CMD/終端機輸出
```
□ 伺服器啟動訊息
□ HTTP 請求記錄
□ 錯誤或警告訊息
```

---

## 💬 與工程師溝通的技巧

### 好的錯誤報告範例

**❌ 不好的報告：**
```
「程式不能用」
「按按鈕沒反應」
「有錯誤」
```

**✅ 好的報告：**
```
【環境】
- Windows 11
- Chrome 120
- 使用本地伺服器（python -m http.server 8000）

【錯誤描述】
- 開啟 http://localhost:8000 後
- 點擊「自己練習」按鈕
- Console 顯示錯誤：GameEngine is not defined

【已嘗試】
- 已確認 game-engine.js 文件存在（37KB）
- 已確認伺服器正常運行
- 已重新整理頁面，問題依舊

【附件】
- Console 截圖
- Network 截圖
- dir 命令輸出
```

---

### 溝通框架：5W1H

**What（什麼）**
- 什麼功能出問題？
- 看到什麼錯誤訊息？

**When（何時）**
- 什麼時候發生的？
- 之前能用嗎？

**Where（何處）**
- 在哪個頁面/功能？
- 錯誤顯示在哪裡？（Console/畫面）

**Who（誰）**
- 是所有人都遇到還是特定人？
- 在什麼環境下？

**Why（為何）**
- 做了什麼操作導致錯誤？
- 改了什麼文件？

**How（如何）**
- 如何重現？
- 如何暫時解決？

---

### 溝通用語對照表

| 非技術用語 | 技術用語 | 說明 |
|-----------|---------|------|
| 「程式壞掉了」 | 「出現錯誤」 | 更具體 |
| 「按鈕沒反應」 | 「點擊按鈕無回應，Console 顯示...」 | 提供細節 |
| 「不能用」 | 「執行 X 功能時出現 Y 錯誤」 | 明確範圍 |
| 「很慢」 | 「載入時間超過 5 秒」 | 量化問題 |
| 「怪怪的」 | 「預期行為是 X，實際行為是 Y」 | 清楚對比 |

---

## 🧰 實用工具清單

### 1. 瀏覽器開發者工具（F12）

**Console 標籤**
- 用途：查看錯誤訊息、輸出日誌
- 快捷鍵：F12 → Console
- 常用命令：
  ```javascript
  console.log(變數)      // 輸出變數內容
  console.error(錯誤)    // 輸出錯誤
  typeof 變數            // 檢查類型
  ```

**Network 標籤**
- 用途：查看文件載入狀態
- 檢查項目：
  - HTTP 狀態碼（200=成功，404=找不到）
  - 文件大小
  - 載入時間
  - 失敗原因

**Sources 標籤**
- 用途：查看源代碼、設置斷點
- 功能：
  - 查看文件內容
  - 搜尋代碼
  - 檢查語法錯誤（紅色波浪線）

**Application 標籤**
- 用途：查看 localStorage、cookies
- 檢查：儲存的數據是否正確

---

### 2. CMD/終端機工具

**檢查文件**
```cmd
dir                          # 列出當前目錄文件
dir core\*.js               # 列出 core 文件夾的 JS 文件
type 文件名                  # 顯示文件內容
```

**啟動本地伺服器**
```cmd
python -m http.server 8000   # Python 伺服器
npx http-server -p 8000      # Node.js 伺服器
```

**檢查語法**
```cmd
node -c 文件.js             # 檢查 JS 語法
```

---

### 3. 文字編輯器功能

**VS Code 推薦功能**
- **語法高亮**：錯誤會顯示紅色波浪線
- **格式化**：自動整理代碼（Shift + Alt + F）
- **搜尋**：快速找到變數使用（Ctrl + F）
- **Go to Definition**：跳到定義處（F12）

**檢查編碼**
- 右下角顯示編碼
- 應該是 UTF-8
- 如果是其他編碼可能導致亂碼

---

### 4. 線上工具

**JSON 驗證**
- JSONLint (jsonlint.com)
- 貼上 JSON 內容，檢查格式

**語法檢查**
- JSHint (jshint.com)
- 檢查 JavaScript 語法

**圖片壓縮**
- TinyPNG (tinypng.com)
- 減少圖片大小，加快載入

---

## 🔥 常見錯誤類型與解決方案

### 類型 1：文件路徑問題

**症狀：**
```
Failed to load resource: net::ERR_FILE_NOT_FOUND
404 Not Found
```

**診斷：**
1. 檢查文件是否存在
2. 檢查路徑拼寫（大小寫）
3. 檢查相對路徑是否正確

**解決：**
```html
❌ <script src="/core/game-engine.js">     # 絕對路徑
✅ <script src="core/game-engine.js">      # 相對路徑

❌ <img src="images\logo.png">             # Windows 路徑
✅ <img src="images/logo.png">             # 網頁路徑
```

---

### 類型 2：CORS 錯誤

**症狀：**
```
Access to fetch at 'file://...' has been blocked by CORS policy
```

**原因：**
- 瀏覽器安全政策
- 直接開啟 HTML 文件（file:// 協議）

**解決：**
1. 使用本地伺服器
2. 或者把所有代碼內嵌在一個 HTML 中

---

### 類型 3：載入順序問題

**症狀：**
```
ReferenceError: X is not defined
```

**原因：**
- B 依賴 A，但 B 先載入

**解決：**
```html
❌ 錯誤順序
<script src="game-engine.js"></script>    # 依賴 ThemeLoader
<script src="theme-loader.js"></script>   # 但這個在後面

✅ 正確順序
<script src="theme-loader.js"></script>   # 先載入依賴
<script src="game-engine.js"></script>    # 後載入使用者

或使用 defer
<script src="theme-loader.js" defer></script>
<script src="game-engine.js" defer></script>
```

---

### 類型 4：語法錯誤

**症狀：**
```
SyntaxError: Unexpected token
```

**常見原因：**
- 缺少括號、大括號
- 多餘的逗號
- 引號不匹配
- 文件被截斷

**診斷：**
```bash
node -c file.js              # 檢查語法
```

**預防：**
- 使用代碼編輯器（VS Code）
- 啟用語法檢查
- 定期備份

---

### 類型 5：編碼問題

**症狀：**
- 中文顯示亂碼
- 奇怪的符號

**解決：**
```html
<!-- 在 HTML 的 <head> 中加入 -->
<meta charset="UTF-8">
```

**文件儲存：**
- 記事本：另存新檔 → 編碼選 UTF-8
- VS Code：右下角確認是 UTF-8

---

## 📝 除錯檢查清單（Checklist）

### 初步檢查
```
□ 文件結構是否正確？
□ 所有必要文件都存在嗎？
□ 文件大小是否合理？
□ 使用本地伺服器了嗎？
□ 瀏覽器 Console 有錯誤嗎？
```

### 環境檢查
```
□ 使用支援的瀏覽器？（Chrome/Firefox）
□ 本地伺服器正確啟動？
□ 在正確的目錄啟動伺服器？
□ 使用正確的 URL？（localhost:8000）
```

### 文件檢查
```
□ HTML 文件編碼是 UTF-8？
□ JavaScript 文件沒有語法錯誤？
□ JSON 文件格式正確？
□ 圖片路徑正確？
```

### 載入檢查
```
□ Network 標籤所有文件都是 200？
□ 沒有 404 或 CORS 錯誤？
□ JavaScript 文件載入順序正確？
□ 全域變數正確定義？
```

### 功能檢查
```
□ 初始化成功？
□ 事件監聽器綁定成功？
□ 數據正確載入？
□ 用戶交互正常？
```

---

## 🎓 進階技巧

### 1. 使用斷點除錯

**在 Sources 標籤：**
1. 找到懷疑的代碼行
2. 點擊行號設置斷點（藍色標記）
3. 執行功能，程式會暫停在斷點
4. 查看當前變數的值
5. 逐步執行（Step Over/Step Into）

---

### 2. 添加詳細日誌

**策略性加入 console.log：**
```javascript
console.log('[Init] 開始初始化...');
console.log('[OK] ThemeLoader 創建成功');
console.log('[Error] 載入失敗:', error);
```

**格式化輸出：**
```javascript
console.log('用戶:', user);                    # 簡單輸出
console.table([{name: 'A', score: 10}]);       # 表格輸出
console.group('初始化步驟');                   # 群組開始
console.log('步驟 1');
console.log('步驟 2');
console.groupEnd();                            # 群組結束
```

---

### 3. 建立除錯模式

**在代碼中加入開關：**
```javascript
const DEBUG = true;  // 開發時設為 true

if (DEBUG) {
    console.log('Debug: 當前狀態', state);
}
```

**好處：**
- 開發時看到詳細資訊
- 正式版關閉 DEBUG，隱藏訊息

---

### 4. 錯誤邊界處理

**好的錯誤處理：**
```javascript
try {
    // 可能出錯的代碼
    const data = await loadData();
} catch (error) {
    // 處理錯誤
    console.error('載入失敗:', error);
    alert('無法載入數據：' + error.message);
}
```

**提供有用的錯誤訊息：**
```javascript
❌ alert('Error');                    # 沒幫助
✅ alert('無法載入主題檔案 theme.json，請檢查文件是否存在');
```

---

## 🎯 預防勝於治療

### 開發時的好習慣

**1. 版本控制**
- 使用 Git
- 經常 commit
- 寫清楚的 commit 訊息

**2. 定期測試**
- 改一點測一點
- 不要累積太多改動

**3. 代碼審查**
- 請別人看看代碼
- 使用 linter 工具

**4. 文檔記錄**
- 記錄重要決策
- 說明複雜邏輯
- 更新 README

**5. 備份策略**
- 保留可運行的版本
- 雲端備份
- 本地備份

---

## 📚 學習資源

### 除錯技巧
- Chrome DevTools 官方文檔
- "Debugging JavaScript" 教學
- Stack Overflow（搜尋錯誤訊息）

### 工具教學
- VS Code 官方教學
- Git 基礎教學
- 瀏覽器開發者工具教學

### 社群資源
- GitHub Issues（看別人怎麼報告問題）
- 技術部落格
- 開發者論壇

---

## 💡 最後的建議

### 給非技術背景專案管理者

**1. 理解基本概念**
- 不需要會寫代碼
- 但要知道大致原理
- 能用正確術語溝通

**2. 建立溝通橋樑**
- 學會收集正確資訊
- 提供完整的錯誤報告
- 理解工程師的需求

**3. 設定合理期望**
- 除錯需要時間
- 有些問題很難重現
- 預留除錯時間

**4. 建立流程**
- 標準的測試流程
- 錯誤報告模板
- 發布前檢查清單

**5. 持續學習**
- 每次除錯都是學習機會
- 記錄常見問題
- 建立知識庫

---

## 🎉 總結：這次學到的關鍵技能

### 技術技能
✅ 使用瀏覽器開發者工具
✅ 讀懂基本錯誤訊息
✅ 了解文件結構重要性
✅ 知道如何測試和驗證

### 溝通技能
✅ 如何描述問題
✅ 如何收集資訊
✅ 如何與工程師溝通
✅ 如何提供有用的回饋

### 思維技能
✅ 系統化思考問題
✅ 逐步縮小範圍
✅ 不猜測，要驗證
✅ 建立測試來證明假設

---

## 📋 快速參考卡

### 遇到錯誤時的 5 個步驟
```
1. 保持冷靜，記錄錯誤訊息
2. 按 F12 查看 Console 和 Network
3. 收集完整資訊（環境、步驟、截圖）
4. 嘗試最簡單的解決方案
5. 如果無法解決，準備好資訊請求協助
```

### 工程師最想要的 5 樣東西
```
1. 完整的錯誤訊息（文字 + 截圖）
2. 能重現問題的步驟
3. 環境資訊（OS、瀏覽器、版本）
4. 你已經嘗試過什麼
5. 相關文件和代碼
```

### 最常用的 5 個除錯工具
```
1. 瀏覽器 Console（F12）
2. Network 標籤（查看載入）
3. node -c（檢查語法）
4. 本地伺服器（python -m http.server）
5. 測試工具（test-js-loading.html）
```

---

**記住：好的除錯不是找到快速解法，而是建立系統化的方法！**

---

*文檔版本：1.0*  
*最後更新：2025-11-27*  
*基於：QuizFlow 3.1 重構專案實戰經驗*
